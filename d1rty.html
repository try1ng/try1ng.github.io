<!DOCTYPE html>
<html>
<body>
<button id="screenBtn">Request screen capture</button>
<video id="video" autoplay playsinline style="width:300px;border:1px solid #ccc;"></video>

<script>
const video = document.getElementById("video");

document.getElementById("screenBtn").onclick = async () => {
  console.log("[1] User clicked button");
  try {
    console.log("[2] Calling getDisplayMedia()");
    const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });

    console.log("[3] Promise resolved â€” stream received");
    console.log("     tracks:", stream.getTracks().map(t => t.kind));
    console.log("     active:", stream.active);

    // attach to video element
    video.srcObject = stream;

    // log track events
    stream.getTracks().forEach(track => {
      console.log(`     track started: ${track.kind}`);

      track.onended = () => {
        console.log(`     track ended: ${track.kind}`);
      }

      track.onmute = () => {
        console.log(`     track muted: ${track.kind}`);
      }

      track.onunmute = () => {
        console.log(`     track unmuted: ${track.kind}`);
      }
    });

    // watch stream active flag periodically
    const interval = setInterval(() => {
      console.log("[stream status] active =", stream.active);
      if (!stream.active) clearInterval(interval);
    }, 2000);

  } catch (e) {
    console.log("[X] Rejected or failed");
    console.log("    name:", e.name);
    console.log("    message:", e.message);
  }
};
</script>
</body>
</html>
